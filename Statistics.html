<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Katuma1</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container page-container">
    <div class="header-container">
      <div class="text-end m-3 header-top">
        <img class="user-img" src="./img/icons8-user-100.png" alt="user">
      </div>
      <div class="header-body">
        <div class="logoImg align-middle">
          <img class="logo" src="https://www.jarviwiki.fi/w/resources/assets/jarvi-meriwiki_logo_fi.png" alt="">
        </div>
        <div class="header-content">
          <div class="slogan">
            <img src="https://www.jarviwiki.fi/w/resources/assets/identifier_message.png" alt="">
          </div>
          <div class="search-container">
            <div class="container-fluid">
              <form class="d-flex" role="search">
                <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                <div class="search-icon">
                  <img class="img-search-icon" src="./img/icons8-search-50.png" alt="">
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="main-nav">
      <a class="main-nav-text" href="index.html">Home</a>
      <a class="main-nav-text" href="Statistics.html">Statistics</a>
      <a class="main-nav-text" href="Documents.html">Documents</a>
      <a class="main-nav-text" href="#">Katumajärvi-info</a>
      <a class="main-nav-text" href="#">Katumajärvi-info</a>
    </div>
    <div class="main-container">
      <div class="main-content">
        <form id="filterForm">
            <label for="startDate">From:</label>
            <input type="date" id="startDate" name="startDate">
            <label for="endDate">To:</label>
            <input type="date" id="endDate" name="endDate">
            <input class="btn btn-primary m-3" type="submit" value="Submit">
        </form>
      </div>
      <div class="main-chart">
        <div class="d-flex justify-content-evenly">
          <div class="main-content">
            <p>pH Values Over Time</p>
            <canvas id="pHChart"></canvas>
          </div>
          <div class="main-content">
            <p>Temperature Values Over Time</p>
            <canvas id="temperatureChart"></canvas>
          </div>
        </div>
      </div>
  
      <script>
          const fileUrl = './Philip_Example_Of_Data.xlsx';
          let jsonData = [];
  
          // Fetch and process the Excel file
          fetch(fileUrl)
              .then(response => response.arrayBuffer())
              .then(data => {
                  const workbook = XLSX.read(data, { type: 'array' });
                  const firstSheetName = workbook.SheetNames[0];
                  const worksheet = workbook.Sheets[firstSheetName];
                  jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
              })
              .catch(error => console.error('Error fetching the Excel file:', error));
  
          // Function to filter and plot data based on datetime range
          function filterAndPlotData(startDate, endDate) {
              const labels = [];
              const pHData = [];
              const temperatureData = [];
              jsonData.forEach((row, index) => {
                  if (index === 0) return; // Skip header row

                  const tsValue = row[13]; // 14th column for timestamp
                  const pHValue = row[10]; // 11th column for pH
                  const temperatureValue = row[12]; // 13th column for temperature
                  const tsDate = new Date(tsValue); // Parse timestamp
                  // Filter by datetime range
                  if (tsDate >= startDate && tsDate <= endDate) {
                      labels.push(tsValue);
                      pHData.push(pHValue);
                      temperatureData.push(temperatureValue);
                  }
              });
              updateChart(pHChart, labels, pHData, 'pH');
              updateChart(temperatureChart, labels, temperatureData, 'Temperature');
          }
          function updateChart(chart, labels, data, label) {
              chart.data.labels = labels;
              chart.data.datasets[0].data = data;
              chart.data.datasets[0].label = label;
              chart.update();
          }
          const pHCtx = document.getElementById('pHChart').getContext('2d');
          const pHChart = new Chart(pHCtx, {
              type: 'line',
              data: {
                  labels: [],
                  datasets: [{
                      label: 'pH',
                      data: [],
                      backgroundColor: 'rgba(75, 192, 192, 0.2)',
                      borderColor: 'rgba(75, 192, 192, 1)',
                      borderWidth: 1
                  }]
              },
              options: {
                  scales: {
                      y: {
                          beginAtZero: true
                      }
                  }
              }
          });
          const temperatureCtx = document.getElementById('temperatureChart').getContext('2d');
          const temperatureChart = new Chart(temperatureCtx, {
  